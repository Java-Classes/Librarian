<!--
  ~ Copyright 2018, TeamDev Ltd. All rights reserved.
  ~
  ~ Redistribution and use in source and/or binary forms, with or without
  ~ modification, must retain the above copyright notice and the following
  ~ disclaimer.
  ~
  ~ THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
  ~ "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
  ~ LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
  ~ A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
  ~ OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  ~ SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  ~ LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  ~ DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
  ~ THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  ~ (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  ~ OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  -->

<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../../bower_components/paper-styles/color.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-dialog-behavior/paper-dialog-behavior.html">
<link rel="import"
      href="../../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import"
      href="../../bower_components/paper-dialog-behavior/paper-dialog-shared-styles.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="./book_values.html">

<dom-module id="exlibris-book-details">
    <template>
        <style>

            :host {
                display: flex;
                justify-content: center;
            }

            .book-card {
                @apply --layout-vertical;
                border-radius: 3px;
                box-shadow: 4px 4px 10px #888888;
                background-color: white;
                max-width: 800px;
                margin: 10px;
            }

            .book-card > .content {
                margin: 10px;
            }

            .book-card .content > .head-region {
                display: flex;
                flex-direction: row;
                justify-content: flex-start;
                align-items: flex-start;
                width: 100%;
            }

            .book-card > .content > .head-region > iron-image {
                width: 40%;
                --iron-image-width: 100%;
                overflow: inherit;
            }

            .book-card > .content > .head-region > iron-image.hidden {
                display: none;
            }

            .book-card > .content > .head-region > .head-info {
                display: flex;
                width: 70%;
                height: 100%;
                padding-left: 30px;
                flex-direction: column;
                justify-content: space-between;
            }

            .book-card > .content > .head-region > .head-info > .head-text {
                flex-direction: column;
                justify-content: flex-start;
            }

            .book-card > .content > .description {
                margin: 10px;
            }

            .book-card > .content > .head-region > .head-info > .head-text > .title {
                font-size: 25px;
                line-height: 30px;
                margin: 10px 0 10px 0;
                text-align: left;
                font-weight: normal;
            }

            .book-card > .content > .head-region > .head-info > .head-text > .author {
                font-size: 12px;
                font-weight: lighter;
                margin: 5px 0 5px 0;
            }

            .book-card > .content > .head-region > .head-info > .head-text > .plain-text {
                white-space: pre;
                font-size: 15px;
                font-weight: bold;
                margin: 5px 0 5px 0;
            }

            @media only screen and (max-width: 400px) {
                .book-card {
                    @apply --layout-vertical;
                    border-radius: 0px;
                    box-shadow: unset;
                    background-color: initial;
                    margin: 0;
                }

                .book-card > .content > .head-region > .head-info > .head-text > .title {
                    font-size: 16px;
                    line-height: 15px;
                    margin: 5px 0 5px 0;
                }

                .book-card > .content > .head-region > .head-info {
                    padding-left: 10px;
                }
            }

            paper-button {
                background-color: var(--app-primary-color, blue);
                color: white;
                width: 200px;
            }

            paper-icon-button {
                color: var(--app-secondary-color, black);
            }

        </style>
        <div class="book-card">
            <div class="content">
                <div class="head-region">
                    <iron-image class$="[[_isImageLoaded(loaded)]]"
                                src="src/exlibris-app/images/cover-placeholder.png"></iron-image>
                    <iron-image preload loaded="{{loaded}}" src="[[book.image]]"></iron-image>
                    <div class="head-info">
                        <div class="head-text">
                            <div class="title">[[book.title]]</div>
                            <div class="author">[[book.author]]</div>
                            <div class="plain-text">[[book.fullStatusMessage]]</div>
                        </div>
                        <div class="head-button">
                            <template is="dom-if" if="[[_isReserved(book.status)]]">
                                <paper-button id="book-details-cancel-button"
                                              raised
                                              on-click="_requestCancelReservation">
                                    CANCEL RESERVATION
                                </paper-button>
                            </template>
                            <template is="dom-if" if="[[_isExpected(book.status)]]">
                                <paper-button id="book-details-reserve-button"
                                              raised
                                              on-click="_requestReservation">
                                    RESERVE
                                </paper-button>
                            </template>
                            <template is="dom-if" if="[[_isBorrowedAndCanBeExtended(book)]]">
                                <paper-button id="book-details-extend-button"
                                              raised
                                              on-click="_requestLoanExtension">
                                    EXTEND FOR TWO WEEKS
                                </paper-button>
                            </template>
                            <template is="dom-if" if="[[_isBorrowedAndCannotBeExtended(book)]]">
                                <h3>RESERVED BY ANOTHER READER</h3>
                            </template>
                        </div>
                    </div>
                </div>
                <div class="description">
                    <div class="plain-text">[[book.description]]</div>
                </div>
            </div>
        </div>
    </template>

    <script>

        class ExlibrisBookDetails extends Polymer.Element {
            static get is() {
                return 'exlibris-book-details';
            }

            static get properties() {
                return {

                    /**
                     * Fired on the `CANCEL RESERVATION` button click.
                     *
                     * @event book-details-cancel-reservation
                     * @param {detail.bookId} the id of a book the reservation of which must be canceled.
                     */

                    /**
                     * Fired on the `RESERVE` button click.
                     *
                     * @event book-details-reserve-book
                     * @param {detail.bookId} the id of a book to reserve.
                     */

                    /**
                     * Fired on the `EXTEND FOR TWO WEEKS` button click.
                     *
                     * @event book-details-extend-loan
                     * @param {detail.bookId} the id of a book the loan period of which must be extended.
                     */

                    /**
                     * The book object to display.
                     */
                    book: {
                        type: Object,
                        value: {
                            id: "8535902731",
                            title: "Java in a Nutshell: A Desktop Quick Reference, Edition 6",
                            image: "https://books.google.com/books/content/images/frontcover/trDXBAAAQBAJ?fife=w200-h300",
                            author: "Benjamin J EvansDavid Flanagan",
                            category: "Java Programming",
                            description: "The latest edition of Java in a Nutshell is designed to help experienced Java programmers get the most out of Java 7 and 8, but it’s also a learning path for new developers. Chock full of examples that demonstrate how to take complete advantage of modern Java APIs and development best practices, the first section of this thoroughly updated book provides a fast-paced, no-fluff introduction to the Java programming language and the core runtime aspects of the Java platform.\n" +
                            "The second section is a reference to core concepts and APIs that shows you how to perform real programming work in the Java environment.\n" +
                            "\n" +
                            "Get up to speed on language details, including Java 8 changes\n" +
                            "Learn object-oriented programming, using basic Java syntax\n" +
                            "Explore generics, enumerations, annotations, and lambda expressions\n" +
                            "Understand basic techniques used in object-oriented design\n" +
                            "Examine concurrency and memory, and how they’re intertwined\n" +
                            "Work with Java collections and handle common data formats\n" +
                            "Delve into Java’s latest I/O APIs, including asynchronous channels\n" +
                            "Use Nashorn to execute JavaScript on the Java Virtual Machine\n" +
                            "Become familiar with development tools in OpenJDK",
                            availableCount: 5,
                            status: 'AVAILABLE'
                        }
                    }
                };
            }

            /**
             * Used to set custom style for the placeholder image
             * when the original image is loaded.
             */
            _isImageLoaded(loaded) {
                return loaded ? 'hidden' : '';
            }

            _isReserved(status) {
                return status === BookStatus.RESERVED;
            }

            _isExpected(status) {
                return status === BookStatus.EXPECTED;
            }

            _isBorrowedAndCanBeExtended(book) {
                return (book.status === BookStatus.SHOULD_RETURN_SOON
                    || book.status === BookStatus.OVERDUE)
                    && book.isAllowedLoanExtension;
            }

            _isBorrowedAndCannotBeExtended(book) {
                return (book.status === BookStatus.SHOULD_RETURN_SOON
                    || book.status === BookStatus.OVERDUE
                    || book.status === BookStatus.BORROWED)
                    && !book.isAllowedLoanExtension;
            }

            /**
             * Handles the `CANCEL RESERVATION` button click.
             *
             * @private
             */
            _requestCancelReservation() {
                this.dispatchEvent(new CustomEvent('book-details-cancel-reservation', {detail: {bookId: this.book.id}}));
            }

            /**
             * Handles the `RESERVE` button click.
             *
             * @private
             */
            _requestReservation() {
                this.dispatchEvent(new CustomEvent('book-details-reserve-book', {detail: {bookId: this.book.id}}));
            }

            /**
             * Handles the `EXTEND FOR TWO WEEKS` button click.
             *
             * @private
             */
            _requestLoanExtension() {
                this.dispatchEvent(new CustomEvent('book-details-extend-loan', {detail: {bookId: this.book.id}}));
            }
        }

        window.customElements.define(ExlibrisBookDetails.is, ExlibrisBookDetails);
    </script>
</dom-module>
